<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QRIS-API</title>
  <style>
    body {margin:0;font-family:Arial,sans-serif;background:#0a0a15;color:#e0e0ff;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
    .container {background:rgba(20,20,50,0.8);border:1px solid #00d4ff;border-radius:16px;padding:30px;max-width:420px;width:100%;box-shadow:0 0 30px rgba(0,212,255,0.2);text-align:center;}
    h1 {color:#00ffea;text-shadow:0 0 15px #00ffea;}
    input {width:100%;padding:14px;font-size:1.2em;border:2px solid #00d4ff;border-radius:10px;background:#111133;color:white;text-align:center;margin:15px 0;}
    button {background:linear-gradient(45deg,#00d4ff,#ff00aa);border:none;color:white;padding:16px 40px;font-size:1.2em;border-radius:50px;cursor:pointer;box-shadow:0 5px 15px rgba(0,212,255,0.4);transition:all 0.3s;}
    button:hover {transform:translateY(-3px);box-shadow:0 10px 25px rgba(0,212,255,0.6);}
    button:disabled {opacity:0.5;}
    #qris-section {margin-top:30px;display:none;}
    #qris-image {max-width:280px;border:3px solid #00ffea;border-radius:12px;box-shadow:0 0 20px rgba(0,255,234,0.5);}
    .error {color:#ff4d4d;font-weight:bold;margin-top:10px;}
    .loading {color:#00ffea;margin:15px 0;display:none;}
  </style>
</head>
<body>
  <div class="container">
    <h1>TESTING API BY XBATS OFFC</h1>
    <input type="number" id="nominal" placeholder="Masukkan nominal (mulai dari 1)" step="0.01" min="0.01">
    <button id="btn">Generate QRIS</button>
    <div class="loading" id="loading">Sedang generate...</div>
    <div id="qris-section">
      <h3>Scan QRIS Ini</h3>
      <img id="qris-image" src="" alt="QRIS">
      <p>Nominal: Rp <span id="nominal-show">0</span><br>Merchant: Toko Gulbat<br>Expire ~15 menit</p>
    </div>
    <p id="error" class="error"></p>
  </div>

  <script>
    const btn = document.getElementById('btn');
    const nominalEl = document.getElementById('nominal');
    const loading = document.getElementById('loading');
    const section = document.getElementById('qris-section');
    const img = document.getElementById('qris-image');
    const show = document.getElementById('nominal-show');
    const err = document.getElementById('error');

    btn.onclick = async () => {
      err.textContent = '';
      const amt = parseFloat(nominalEl.value);
      if (isNaN(amt) || amt <= 0) {
        err.textContent = 'Nominal harus lebih dari 0!';
        return;
      }

      btn.disabled = true;
      loading.style.display = 'block';

      try {
        // PASTIKAN URL INI SESUAI PROJECT VERCEL LO
        // Contoh: https://qris-api-fawn.vercel.app/api/qris?amount=${amt}
        const res = await fetch(`https://qrisku-apii.vercel.app/api/qris?amount=${amt}`);

        if (!res.ok) {
          throw new Error(`HTTP error ${res.status}`);
        }

        const data = await res.json();

        if (data.success) {
          img.src = data.qr_image_base64;
          show.textContent = amt.toLocaleString('id-ID', {minimumFractionDigits: 0, maximumFractionDigits: 2});
          section.style.display = 'block';
        } else {
          err.textContent = data.error || 'Gagal generate QRIS';
        }
      } catch (e) {
        err.textContent = 'Failed to fetch: ' + e.message;
        console.error(e);
      } finally {
        btn.disabled = false;
        loading.style.display = 'none';
      }
    };

    nominalEl.onkeypress = e => { if (e.key === 'Enter') btn.click(); };
  </script>
</body>
</html>
